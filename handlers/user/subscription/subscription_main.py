from core.imports import wraps, telebot, types, os, json, re, datetime, timedelta, pytz, ReplyKeyboardMarkup, ReplyKeyboardRemove
from core.bot_instance import bot
from core.config import PAYMENT_PROVIDER_TOKEN

from handlers.user.utils import (
    restricted, track_user_activity, check_chat_state, check_user_blocked,
    log_user_actions, check_subscription_chanal, text_only_handler,
    rate_limit_with_captcha, check_function_state_decorator, track_usage, check_subscription
)

# ---------------------------------------------------- –ü–û–î–ü–ò–°–ö–ê –ù–ê –ë–û–¢–ê ------------------------------------------------------------

@bot.message_handler(func=lambda message: message.text == "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –±–æ—Ç–∞")
@check_function_state_decorator('–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –±–æ—Ç–∞')
@track_usage('–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –±–æ—Ç–∞')
@restricted
@track_user_activity
@check_chat_state
@check_user_blocked
@log_user_actions
@check_subscription_chanal
@text_only_handler
@rate_limit_with_captcha
def payments_function(message, show_description=True):
    description = (
        "‚ÑπÔ∏è *–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –±–æ—Ç–∞*\n\n"
        "üìå –ü–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ *–≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –±–æ—Ç–∞*.\n*–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã:* _–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã (–∞–ª–∫–æ–≥–æ–ª—å, –Ω–∞–ª–æ–≥), –Ω–∞–π—Ç–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –∫–æ–¥ —Ä–µ–≥–∏–æ–Ω–∞, –∫–æ–¥—ã obd2, –∞–Ω—Ç–∏—Ä–∞–¥–∞—Ä, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è, –ø—Ä–æ—á–µ–µ (–Ω–æ–≤–æ—Å—Ç–∏, –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç, –±–ª–∞–Ω–∫–∏, –¥–ª—è —Ä–µ–∫–ª–∞–º—ã, —á–∞—Ç —Å –∞–¥–º–∏–Ω–æ–º)_\n\n"
        "üìÖ *–í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏:*\n"
        "üëâ *3 –¥–Ω—è:* 70 ‚ÇΩ ‚Äî –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å –±–æ—Ç–æ–º!\n"
        "üëâ *7 –¥–Ω–µ–π:* 105 ‚ÇΩ ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π!\n"
        "üëâ *30 –¥–Ω–µ–π:* 360 ‚ÇΩ ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!\n"
        "üëâ *90 –¥–Ω–µ–π:* 900 ‚ÇΩ ‚Äî —ç–∫–æ–Ω–æ–º–∏—è –∏ —É–¥–æ–±—Å—Ç–≤–æ –±–µ–∑ —á–∞—Å—Ç–æ–≥–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è!\n"
        "üëâ *180 –¥–Ω–µ–π:* 1620 ‚ÇΩ ‚Äî –±–æ–ª—å—à–µ –≤—ã–≥–æ–¥—ã –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏!\n"
        "üëâ *365 –¥–Ω–µ–π:* 2920 ‚ÇΩ ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è –¥–æ 50%!\n\n"
        "üéÅ –ù–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è *–ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –Ω–∞ 3 –¥–Ω—è*!\n\n"
        "üìà *–ë–∞–ª–ª—ã –∏ –±–æ–Ω—É—Å—ã:*\n"
        "- *1 –±–∞–ª–ª –≤ –¥–µ–Ω—å* –ø–µ—Ä–≤—ã–µ 7 –¥–Ω–µ–π, –∑–∞—Ç–µ–º *0.5 –±–∞–ª–ª–∞ –≤ –¥–µ–Ω—å* –∑–∞ –≤—Ö–æ–¥\n"
        "- *3/5/10/8/12/15 –±–∞–ª–ª–æ–≤* –∑–∞ –ø–µ—Ä–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É (3/7/30/90/180/365 –¥–Ω–µ–π)\n"
        "- *0.5/1/3/2/5/10 –±–∞–ª–ª–æ–≤* –∑–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É (3/7/30/90/180/365 –¥–Ω–µ–π)\n"
        "- *1 –±–∞–ª–ª* –¥–ª—è —Ç–æ–ø-10 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –∫–∞–∂–¥—ã–µ 30 –¥–Ω–µ–π\n"
        "- *–¢–æ–ø-1:* +3 –¥–Ω—è, *–¢–æ–ø-2:* +2 –¥–Ω—è, *–¢–æ–ø-3:* +1 –¥–µ–Ω—å –ø–æ–¥–ø–∏—Å–∫–∏ –∫–∞–∂–¥—ã–µ 30 –¥–Ω–µ–π\n\n"
        "üéâ –û–±–º–µ–Ω–∏–≤–∞–π—Ç–µ –±–∞–ª–ª—ã:\n"
        "- *5 –±–∞–ª–ª–æ–≤ = 1 —á–∞—Å* –ø–æ–¥–ø–∏—Å–∫–∏\n"
        "- *2 –±–∞–ª–ª–∞ = 15 –º–∏–Ω—É—Ç* –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º\n"
        "- *10 –±–∞–ª–ª–æ–≤ = 5% —Å–∫–∏–¥–∫–∏* (–¥–æ 35%)\n\n"
        "ü§ù *–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:*\n"
        "–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ:\n"
        "- *1 —Ä–µ—Ñ–µ—Ä–∞–ª = +1 –¥–µ–Ω—å –ø–æ–¥–ø–∏—Å–∫–∏ + 1 –±–∞–ª–ª*\n"
        "- *5 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ = +5 –¥–Ω–µ–π –ø–æ–¥–ø–∏—Å–∫–∏ + 1.5 –±–∞–ª–ª–∞ –∑–∞ –∫–∞–∂–¥–æ–≥–æ (5‚Äì7)*\n"
        "- *10 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ = +10 –¥–Ω–µ–π –ø–æ–¥–ø–∏—Å–∫–∏ + 10% —Å–∫–∏–¥–∫–∞ + 1 –±–∞–ª–ª –∑–∞ 8‚Äì10, 1.5 –∑–∞ 11+*\n"
        "- –ï—Å–ª–∏ —Ä–µ—Ñ–µ—Ä–∞–ª –∫—É–ø–∏—Ç –ø–æ–¥–ø–∏—Å–∫—É:\n"
        "  - 3 –¥–Ω—è: *+0.5 –¥–Ω—è* –ø–æ–¥–ø–∏—Å–∫–∏\n"
        "  - 7 –¥–Ω–µ–π: *+1 –¥–µ–Ω—å* –ø–æ–¥–ø–∏—Å–∫–∏\n"
        "  - 30 –¥–Ω–µ–π: *+3 –¥–Ω—è* –ø–æ–¥–ø–∏—Å–∫–∏\n"
        "  - 90 –¥–Ω–µ–π: *+2 –¥–Ω—è* –ø–æ–¥–ø–∏—Å–∫–∏\n"
        "  - 180 –¥–Ω–µ–π: *+5 –¥–Ω–µ–π* –ø–æ–¥–ø–∏—Å–∫–∏\n"
        "  - 365 –¥–Ω–µ–π: *+7 –¥–Ω–µ–π* –ø–æ–¥–ø–∏—Å–∫–∏\n\n"
        "üî• *–ü–æ–¥–∞—Ä–∫–∏:*\n"
        "  - *–ë–∞–ª–ª—ã:* –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–∞—Ä–∏—Ç—å –±–∞–ª–ª—ã –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º 1 —Ä–∞–∑ –≤ 24 —á–∞—Å–∞\n"
        "  - *–í—Ä–µ–º—è:* –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–∞—Ä–∏—Ç—å –≤—Ä–µ–º—è –ø–æ–¥–ø–∏—Å–∫–∏ –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º 1 —Ä–∞–∑ –≤ 24 —á–∞—Å–∞\n\n"        
        "üí• *–õ–æ—è–ª—å–Ω–æ—Å—Ç—å:* 3 –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ = *10% —Å–∫–∏–¥–∫–∞* –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –ø–æ–∫—É–ø–∫—É (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)\n\n"
        "üì∫ *–†–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–Ω–∞–ª—ã:* +1 –¥–µ–Ω—å –ø–æ–¥–ø–∏—Å–∫–∏ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª\n\n"
    )

    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add('–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É')
    markup.add('–í–∞—à–∏ –ø–æ–¥–ø–∏—Å–∫–∏', '–í–æ–∑–≤—Ä–∞—Ç')
    markup.add('–ú–∞–≥–∞–∑–∏–Ω', '–ë–∞–ª–ª—ã', '–ü—Ä–æ–º–æ–∫–æ–¥—ã')
    markup.add('–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞', '–†–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–Ω–∞–ª—ã')
    markup.add('–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é')

    if show_description:
        bot.send_message(message.chat.id, description, reply_markup=markup, parse_mode="Markdown")
    else:
        bot.send_message(message.chat.id, "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup)

@bot.message_handler(func=lambda message: message.text == "–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø–æ–¥–ø–∏—Å–∫—É")
@check_function_state_decorator('–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø–æ–¥–ø–∏—Å–∫—É')
@track_usage('–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø–æ–¥–ø–∏—Å–∫—É')
@restricted
@track_user_activity
@check_chat_state
@check_user_blocked
@log_user_actions
@check_subscription_chanal
@text_only_handler
@rate_limit_with_captcha
def return_to_subscription(message):
    payments_function(message, show_description=False)